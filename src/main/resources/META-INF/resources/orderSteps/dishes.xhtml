<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<h:outputText id="price" value="#{orderView.totalPrice}">
		<f:convertNumber currencyCode="EUR" type="currency" />
	</h:outputText>

	<p:repeat var="dishOrder" value="#{orderView.dishOrders}">
		<div class="order-dish">
			<div class="image-wrapper">
				<p:graphicImage value="#{dishOrder.dish.imageData}" styleClass="product-image"
					rendered="#{dishOrder.dish.hasImageData()}" stream="false" />
				<p:graphicImage library="images" name="default.png" styleClass="product-image"
					rendered="#{not dishOrder.dish.hasImageData()}" />
			</div>

			<div class="product-details">
				<div class="product-name">
					<h:outputText value="#{dishOrder.dish.dishName}" styleClass="product-image" />
				</div>
				<div class="product-category #{dishOrder.dish.category.name()}">
					<h:outputText value="#{labels[dishOrder.dish.category.i18nKey]}" />
				</div>
				<div class="product-id">
					<h:outputText value="#{labels['order.dish.id']}: " />
					<h:outputText value="#{dishOrder.dish.dishId}" />
				</div>
			</div>

			<div class="order-details">
				
				
				
				<p:rating value="#{orderView.findAverageRatingOfDish(dishOrder.dish)}" readonly="true" required="false"
					styleClass="rating"/>
				<p:commandButton id="show-reviews" type="button" value="#{labels['order.show-customer-reviews']}"/>
				<p:overlayPanel for="show-reviews" my="center top">
					<p:dataTable value="#{orderView.findReviewsPerDish(dishOrder)}" var="review">
						<p:column>
							<p:rating value="#{review.rating}" readonly="true" required="false"/>
						</p:column>
						<p:column headerText="#{labels['edit-review.header']}">
							<p:outputLabel value="#{review.header}"/>
						</p:column>
						<p:column headerText="#{labels['edit-review.explanation']}">
							<p:outputLabel value="#{review.explanation}"/>
						</p:column>
					</p:dataTable>
				</p:overlayPanel>
				
				<div class="price">
					<h:outputText value="#{dishOrder.dish.price}">
						<f:convertNumber currencyCode="EUR" type="currency" />
					</h:outputText>
				</div>
				
				<p:inputText value="#{dishOrder.quantity}"
					validatorMessage="#{exceptions['order.quantity-validation-error']}"
					converterMessage="#{exceptions['order.quantity-conversion-error']}">
					<f:validateLongRange minimum="0" />
					<p:ajax event="keyup" listener="#{orderView.calculateTotalPrice()}" update="@form:price" />
				</p:inputText>
			</div>
		</div>
	</p:repeat>

</ui:composition>